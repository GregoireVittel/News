<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Today's News - Global Sources</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .news-section {
            margin-bottom: 30px;
        }
        .news-section h2 {
            margin-bottom: 10px;
            font-size: 22px;
            color: #333;
        }
        .news-item {
            margin-bottom: 20px;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .news-item h3 {
            margin: 0;
            font-size: 18px;
        }
        .news-item p {
            margin: 5px 0;
            color: #555;
        }
        .news-item a {
            color: #007BFF;
            text-decoration: none;
        }
        .news-item a:hover {
            text-decoration: underline;
        }
        .source {
            font-size: 14px;
            color: #888;
            margin-top: 5px;
        }
        .timestamp {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .sentiment {
            font-size: 14px;
            margin-top: 5px;
            padding: 3px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        .positive {
            background-color: #d4edda;
            color: #155724;
        }
        .negative {
            background-color: #f8d7da;
            color: #721c24;
        }
        .neutral {
            background-color: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
    <h1>Today's News</h1>
    <div id="news-container">
        <div class="news-section" id="positive-news">
            <h2>Positive News</h2>
        </div>
        <div class="news-section" id="negative-news">
            <h2>Negative News</h2>
        </div>
        <div class="news-section" id="neutral-news">
            <h2>Neutral News</h2>
        </div>
    </div>

    <script>
        // RSS feed URLs
        const rssFeeds = {
            cnn: 'http://rss.cnn.com/rss/cnn_topstories.rss',
            nyt: 'https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml',
            fox: 'http://feeds.foxnews.com/foxnews/latest',
            bbc: 'http://feeds.bbci.co.uk/news/rss.xml',
            reuters: 'http://feeds.reuters.com/reuters/topNews',
            leMonde: 'https://www.lemonde.fr/rss/une.xml',
            gazeta: 'https://wyborcza.pl/0,0.xml'
        };

        // Keywords for sentiment analysis
        const positiveKeywords = ['happy', 'win', 'success', 'positive', 'growth', 'good', 'hope', 'peace', 'achievement', 'progress'];
        const negativeKeywords = ['sad', 'loss', 'failure', 'negative', 'decline', 'bad', 'crisis', 'war', 'death', 'attack'];

        // Function to analyze sentiment
        function analyzeSentiment(text) {
            const lowerText = text.toLowerCase();
            let positiveCount = 0;
            let negativeCount = 0;

            positiveKeywords.forEach(word => {
                if (lowerText.includes(word)) positiveCount++;
            });

            negativeKeywords.forEach(word => {
                if (lowerText.includes(word)) negativeCount++;
            });

            if (positiveCount > negativeCount) return 'positive';
            if (negativeCount > positiveCount) return 'negative';
            return 'neutral';
        }

        // Function to fetch and parse the RSS feed
        async function fetchRSSFeed(url) {
            const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`);
            const data = await response.json();
            return data.items;
        }

        // Function to filter items by today's date
        function filterTodayItems(items) {
            const today = new Date();
            const todayDateString = today.toISOString().split('T')[0]; // Get today's date in YYYY-MM-DD format

            return items.filter(item => {
                const itemDate = new Date(item.pubDate).toISOString().split('T')[0];
                return itemDate === todayDateString;
            });
        }

        // Function to display the news items
        function displayNews(items, source) {
            const positiveSection = document.getElementById('positive-news');
            const negativeSection = document.getElementById('negative-news');
            const neutralSection = document.getElementById('neutral-news');

            items.forEach(item => {
                const sentiment = analyzeSentiment(item.title + ' ' + item.description);

                const newsItem = document.createElement('div');
                newsItem.className = 'news-item';

                const title = document.createElement('h3');
                title.textContent = item.title;

                const description = document.createElement('p');
                description.innerHTML = item.description;

                const link = document.createElement('a');
                link.href = item.link;
                link.textContent = 'Read more...';
                link.target = '_blank';

                const timestamp = document.createElement('div');
                timestamp.className = 'timestamp';
                timestamp.textContent = `Published: ${new Date(item.pubDate).toLocaleString()}`;

                const sentimentElement = document.createElement('div');
                sentimentElement.className = `sentiment ${sentiment}`;
                sentimentElement.textContent = `Sentiment: ${sentiment}`;

                const sourceElement = document.createElement('div');
                sourceElement.className = 'source';
                sourceElement.textContent = `Source: ${source.toUpperCase()}`;

                newsItem.appendChild(title);
                newsItem.appendChild(description);
                newsItem.appendChild(link);
                newsItem.appendChild(timestamp);
                newsItem.appendChild(sentimentElement);
                newsItem.appendChild(sourceElement);

                // Append to the appropriate section based on sentiment
                if (sentiment === 'positive') {
                    positiveSection.appendChild(newsItem);
                } else if (sentiment === 'negative') {
                    negativeSection.appendChild(newsItem);
                } else {
                    neutralSection.appendChild(newsItem);
                }
            });
        }

        // Fetch and display all RSS feeds
        async function fetchAllFeeds() {
            const today = new Date().toISOString().split('T')[0];
            console.log(`Fetching news for today: ${today}`);

            for (const [source, url] of Object.entries(rssFeeds)) {
                try {
                    const items = await fetchRSSFeed(url);
                    const todayItems = filterTodayItems(items);
                    displayNews(todayItems, source);
                } catch (error) {
                    console.error(`Error fetching ${source} RSS feed:`, error);
                }
            }
        }

        // Fetch and display the RSS feeds when the page loads
        fetchAllFeeds();
    </script>
</body>
</html>